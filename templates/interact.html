{% extends "base.html" %}
{%block content%}
  <div class="modal fade" id="text-edit" tabindex="-1" role="dialog" aria-labelledby="text-edit-title" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="text-edit-title">Edit Text</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input id="img-text-id" type="hidden"/>
          <div class="row">
            <div class="col-sm-12 text-center">  
              <input id="edit-text" type="text"/>
            </div>
          </div>
          <br/>
          <br/>
          <div class="row">
            <div class="col-sm-12 text-center">
              <div id="sample-text-box"></div>          
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="saveText();">Edit Text</button>
          <button type="button" id="text-visibility" class="btn btn-primary" onclick="toggleTextVisibility();">Remove Text</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <span id="tool-box-toggle" onclick="openNav()">â˜°</span>
  <div class="tool-box no-print" style="width:0px;">
    <a href="/">Home</a>
    <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&times;</a>
    <a href="#" onclick="javasript:openSpaces();">Open Spaces</a>
    <a href="#" onclick="javasript:closeSpaces();">Close Spaces</a>
    <table>
      <tr>
        <td>Locations:</td>
        <td>
          <label class="switch">
            <input id="location" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr>
        <td>Text Confidence:</td>
        <td>
          <label class="switch">
            <input id="confidence" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr>
        <td>N-Gram Usage:</td>
        <td>
          <label class="switch">
            <input id="ngram" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr>
        <td>Uniqueness:</td>
        <td>
          <label class="switch">
            <input id="uniqueness" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr id="uniqueness-range" style="display:none;">
        <td colspan="2" style="padding: 0 0 15px 0;">YEAR:
            <div class="range-slider">
              <input class="range-slider__range" type="range" value="1800" min="1800" max="2000" onchange="setUniqueness(this.value)"><span class="range-slider__value">1800</span>
            </div>
        </td>
      </tr>
      <tr>
        <td>OCR:</td>
        <td>
          <label class="switch">
            <input id="ocr-text" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      {% if session["options"]["translate"]==True %}
      <tr>
        <td>Translate:</td>
        <td>
          <label class="switch">
            <input id="translate-text" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      {% endif %}
      <tr>
        <td>Draw Mode:</td>
        <td>
          <label class="switch">
            <input id="draw-tool" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr>
        <td>Remove Words:</td>
        <td>
          <label class="switch">
            <input id="remove-word" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr>
        <td>Replace Pronouns:</td>
        <td>
          <label class="switch">
            <input id="replace-pronoun" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr class="gender-pronoun" style="display: none;">
        <td>Male:</td>
        <td>
          <label class="switch">
              <input id="male-pronoun" type="checkbox"/>
              <span class="slider round"></span>
          </label>
        </td>
      </tr>
      <tr class="gender-pronoun" style="display: none;">
        <td>Female:</td>
        <td>
          <label class="switch">
            <input id="female-pronoun" type="checkbox"/>
            <span class="slider round"></span>
          </label>
        </td>
      </tr>
    </table>
    <a href="#" onclick="print();">Print</a>    
  </div>
  <div class="stage container-fluid">
  	 <div class="row">
  		<div class="vis no-print">
        {% for i in range(image_text|length) %}
        {% if i > 0 and (image_patches|length) > 0 %}
        <div class="img-block img-patch squeeze" id="{{i}}" data-img-height="{{ image_patches[i-1]['height'] }}" data-map-height="{{ image_patches[i-1]['map_height'] }}" style="width:{{ image_patches[i-1]['width'] }}px;height:0px;">
          <img src="data:image/png;base64,{{ image_patches[i-1]['src'] }}"/>
          <input style="margin-left:{{ bounding_boxes[i-1]['x'] }}px;width:{{bounding_boxes[i-1]['w']}}px;" class="img-patch-text" type="text" />
          <canvas class="ngram-usage"></canvas>
          <div class="uniqueness-chart"></div>
        </div>
        {% endif %}
        <div class="img-block" id="{{i}}" style="height:{{ image_dim[i]['height'] }}px;background-image: url('data:image/png;base64,{{ image_patches[i-1]['src'] }}');">
          {% for y in range(image_text[i]|length) %}
          <span class="text-box"><div style="width:{{image_text[i][y]['width']}}px;" class="custom-text text-center"></div><img id="text-{{i}}-{{y}}" class="img-text" src="data:image/png;base64,{{image_text[i][y]['src']}}"/></span>
          {% endfor %}
          <canvas class="text-confidence"></canvas>
          <canvas class="entity-location"></canvas>
        </div>
        {% endfor %}
        <canvas class="overlay" id="draw-board"></canvas>
      </div>
    </div>
    <div id="color-options">
    <div id="text-options">
      <span id="text-color-select"></span>
      <div style="height:30px;padding-left:40px;">TEXT COLOR</div>
      <div class="draw-color" style="background:#D93240;" id="#D93240" onclick="textColor(this)"></div>
      <div class="draw-color" style="background:#638CA6;" id="#638CA6" onclick="textColor(this)"></div>
      <div class="draw-color" style="background:#BFD4D9;" id="#BFD4D9" onclick="textColor(this)"></div>
      <div class="draw-color" style="background:#0F5959;" id="#0F5959" onclick="textColor(this)"></div>
      <div class="draw-color" style="background:#17A697;" id="#17A697" onclick="textColor(this)"></div>
      <div class="draw-color" style="background:black;" id="black" onclick="textColor(this)"></div>
      <div class="draw-color" style="background:white;" id="white" onclick="textColor(this)"></div>
    </div>
    <div id="draw-options">
      <span id="draw-color-select"></span>
      <div style="height:30px;padding-left:40px;">PEN COLOR</div>
      <div class="draw-color" style="background:#D93240;" id="#D93240" onclick="color(this)"></div>
      <div class="draw-color" style="background:#638CA6;" id="#638CA6" onclick="color(this)"></div>
      <div class="draw-color" style="background:#BFD4D9;" id="#BFD4D9" onclick="color(this)"></div>
      <div class="draw-color" style="background:#0F5959;" id="#0F5959" onclick="color(this)"></div>
      <div class="draw-color" style="background:#17A697;" id="#17A697" onclick="color(this)"></div>
      <div class="draw-color" style="background:black;" id="black" onclick="color(this)"></div>
      <div class="draw-color" style="background:white;" id="white" onclick="color(this)"></div>
      <br/>
      <input type="button" value="clear" id="clr" onclick="erase()">
    </div>
    </div>
  </div>
{%endblock%}
{%block scripts%}
  <script src="./static/js/main.js"></script>
  <script type="text/javascript">
    var ocr = {{ ocr|safe }}
    var translation = {{ translation|safe }}
    var word_blocks = {{ word_blocks|safe }}
    var ngram_plot = {{ ngram_plot|safe }}
</script>
  <script type='text/javascript' src="https://cdn.jsdelivr.net/g/canvas2image@0.1(base64.js+canvas2image.min.js+canvas2image.js)"></script>  
  <script type='text/javascript' src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
  <script src="./static/js/interact.js"></script>
{%endblock%}